{% extends "base.html" %}

{% block title %}Ph√¢n t√≠ch d·ªØ li·ªáu phim - Movie Data Analytics{% endblock %}

{% block head %}
<style>
/* Sample Data Table Styling */
.data-sample {
    padding: 60px 0;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(236, 72, 153, 0.05) 100%);
}

.sample-header {
    text-align: center;
    margin-bottom: 40px;
}

.sample-header h2 {
    color: #fff;
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 10px;
    background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.sample-header p {
    color: #c5c7d4;
    font-size: 1.1rem;
    max-width: 600px;
    margin: 0 auto;
}

.sample-table-container {
    background: rgba(15, 23, 42, 0.8);
    border-radius: 16px;
    border: 1px solid rgba(139, 92, 246, 0.2);
    overflow: hidden;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
}

.sample-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
}

.sample-table thead th {
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(236, 72, 153, 0.2) 100%);
    color: #fff;
    font-weight: 600;
    padding: 16px 12px;
    text-align: left;
    border-bottom: 2px solid rgba(139, 92, 246, 0.3);
    position: sticky;
    top: 0;
    z-index: 10;
}

.sample-table tbody td {
    padding: 14px 12px;
    border-bottom: 1px solid rgba(139, 92, 246, 0.1);
    color: #e2e8f0;
    vertical-align: top;
}

.sample-table tbody tr:nth-child(even) {
    background: rgba(139, 92, 246, 0.02);
}

.sample-table tbody tr:hover {
    background: rgba(139, 92, 246, 0.1);
    transition: background-color 0.2s ease;
}

.sample-table tbody tr:last-child td {
    border-bottom: none;
}

/* Responsive table */
@media (max-width: 768px) {
    .sample-table-container {
        overflow-x: auto;
        margin: 0 -20px;
        border-radius: 0;
    }
    
    .sample-table {
        min-width: 800px;
    }
    
    .sample-header h2 {
        font-size: 2rem;
    }
    
    .sample-header p {
        font-size: 1rem;
        padding: 0 20px;
    }
}

.sample-info {
    margin-top: 20px;
    text-align: center;
}

/* Data quality info styling */
.data-quality-info details {
    margin-top: 15px;
}

.data-quality-info summary {
    cursor: pointer;
    user-select: none;
    transition: color 0.2s ease;
}

.data-quality-info summary:hover {
    color: #c084fc !important;
}
</style>
{% endblock %}

{% block content %}
<section class="data-header">
    <div class="container section-header">
        <p class="eyebrow">Data Analytics</p>
        <h1>Ph√¢n t√≠ch d·ªØ li·ªáu ƒëi·ªán ·∫£nh to√†n c·∫ßu</h1>
        <p>Kh√°m ph√° insights t·ª´ dataset {{ stats.total_movies }} b·ªô phim t·ª´ nhi·ªÅu qu·ªëc gia th√¥ng qua bi·ªÉu ƒë·ªì tr·ª±c quan</p>
        
        <!-- Data Quality Explanation -->
        <div class="data-quality-info" style="background: rgba(139, 92, 246, 0.1); border-left: 4px solid #8b5cf6; padding: 20px; margin: 30px 0; border-radius: 8px;">
            <h3 style="color: #8b5cf6; margin-top: 0; font-size: 1.2rem;">üìä V·ªÅ dataset ph√¢n t√≠ch</h3>
            <p style="color: #c5c7d4; line-height: 1.8; margin: 10px 0;">
                <strong style="color: #fff;">Dataset g·ªëc:</strong> 2,193 b·ªô phim t·ª´ nhi·ªÅu qu·ªëc gia ƒë√£ chi·∫øu t·∫°i Vi·ªát Nam (1990-2024)<br>
                <strong style="color: #fff;">Dataset ph√¢n t√≠ch:</strong> 1,018 b·ªô phim (46.4% dataset g·ªëc)<br>
                <strong style="color: #fff;">B·ªã lo·∫°i b·ªè:</strong> 1,175 b·ªô phim (53.6%) do thi·∫øu d·ªØ li·ªáu quan tr·ªçng
            </p>
            <details style="margin-top: 15px; cursor: pointer;">
                <summary style="color: #a855f7; font-weight: 600; cursor: pointer; user-select: none;">‚ùì T·∫°i sao lo·∫°i b·ªè h∆°n 50% d·ªØ li·ªáu? (Click ƒë·ªÉ xem chi ti·∫øt)</summary>
                <div style="margin-top: 15px; padding-left: 20px; border-left: 2px solid rgba(139, 92, 246, 0.3);">
                    <p style="color: #c5c7d4; line-height: 1.8;">
                        <strong style="color: #fff;">L√Ω do khoa h·ªçc:</strong> ƒê·ªÉ ƒë·∫£m b·∫£o ch·∫•t l∆∞·ª£ng ph√¢n t√≠ch v√† model ML, ch√∫ng t√¥i ch·ªâ s·ª≠ d·ª•ng phim c√≥ ƒë·∫ßy ƒë·ªß th√¥ng tin:
                    </p>
                    <ul style="color: #c5c7d4; line-height: 1.8; margin: 10px 0;">
                        <li><strong style="color: #e74c3c;">774 phim</strong> kh√¥ng c√≥ d·ªØ li·ªáu <strong>Revenue</strong> (doanh thu) ‚Üí Kh√¥ng th·ªÉ t√≠nh ROI v√† ƒë√°nh gi√° th√†nh c√¥ng t√†i ch√≠nh</li>
                        <li><strong style="color: #e74c3c;">399 phim</strong> kh√¥ng c√≥ d·ªØ li·ªáu <strong>Budget</strong> (ng√¢n s√°ch) ‚Üí Kh√¥ng th·ªÉ t√≠nh ROI = Revenue/Budget (chia cho 0)</li>
                        <li><strong style="color: #e74c3c;">2 phim</strong> kh√¥ng c√≥ <strong>Vote Average</strong> ‚Üí Kh√¥ng th·ªÉ ƒë√°nh gi√° ch·∫•t l∆∞·ª£ng n·ªôi dung</li>
                    </ul>
                    <p style="color: #27ae60; font-weight: 600; margin-top: 15px;">
                        ‚úÖ K·∫øt qu·∫£: 1,018 phim c√≥ ƒë·∫ßy ƒë·ªß Budget, Revenue, Runtime, Vote Average - ƒë·ªß ƒë·ªÉ train model ML ch√≠nh x√°c!
                    </p>
                </div>
            </details>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-number">{{ stats.total_movies }}</span>
                <span class="stat-label">Phim ph√¢n t√≠ch</span>
                <span class="stat-sublabel" style="font-size: 0.75rem; color: #a855f7;">T·ª´ 2,193 phim g·ªëc</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">{{ "%.1f"|format(stats.success_rate) }}%</span>
                <span class="stat-label">T·ª∑ l·ªá th√†nh c√¥ng</span>
                <span class="stat-sublabel" style="font-size: 0.75rem; color: #27ae60;">ROI‚â•1 & Vote‚â•6.5</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">${{ "{:,.0f}".format(stats.avg_budget) }}</span>
                <span class="stat-label">Ng√¢n s√°ch TB</span>
                <span class="stat-sublabel" style="font-size: 0.75rem; color: #3498db;">Trung b√¨nh to√†n c·∫ßu</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">{{ "%.1f"|format(stats.avg_vote) }}</span>
                <span class="stat-label">ƒêi·ªÉm ƒë√°nh gi√° TB</span>
                <span class="stat-sublabel" style="font-size: 0.75rem; color: #e67e22;">Thang ƒëi·ªÉm 10</span>
            </div>
        </div>
    </div>
</section>

<section class="data-sample">
    <div class="container">
        <div class="sample-header">
            <h2>üìã M·∫´u d·ªØ li·ªáu ph√¢n t√≠ch</h2>
            <p>10 d√≤ng ƒë·∫ßu ti√™n t·ª´ dataset {{ stats.total_movies }} b·ªô phim ƒë√£ ƒë∆∞·ª£c l√†m s·∫°ch v√† chu·∫©n h√≥a</p>
        </div>
        
        <div class="sample-table-container">
            <table class="sample-table">
                <thead>
                    <tr>
                        {% for col in stats.sample_columns %}
                        <th>{{ col }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in stats.sample_data %}
                    <tr>
                        {% for col in stats.sample_columns %}
                        <td>
                            {% if col == 'Budget' or col == 'Revenue' %}
                                ${{ "{:,.0f}".format(row[col]) }}
                            {% elif col == 'Vote Average' %}
                                {{ "%.1f"|format(row[col]) }}/10
                            {% elif col == 'Vote Count' %}
                                {{ "{:,.0f}".format(row[col]) }}
                            {% elif col == 'Runtime' %}
                                {{ row[col] }} ph√∫t
                            {% else %}
                                {{ row[col] }}
                            {% endif %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div class="sample-info">
            <p style="color: #a855f7; font-size: 0.9rem; text-align: center; margin-top: 20px;">
                üí° <strong>Dataset ƒë·∫ßy ƒë·ªß:</strong> {{ stats.total_movies }} b·ªô phim ‚Ä¢ 
                <strong>Th·ªùi gian:</strong> {{ stats.year_range }} ‚Ä¢ 
                <strong>Ch·∫•t l∆∞·ª£ng:</strong> ƒê√£ lo·∫°i b·ªè {{ stats.removed_movies }} phim thi·∫øu d·ªØ li·ªáu
            </p>
        </div>
    </div>
</section>

<section class="data-visualizations">
    <div class="container">
        <div class="chart-grid">
            <!-- Budget Distribution -->
            <div class="chart-card">
                <h3>üìä Ph√¢n b·ªë ng√¢n s√°ch s·∫£n xu·∫•t</h3>
                <div class="chart-container">
                    <img src="{{ url_for('static', filename='images/charts/budget_dist.png') }}" alt="Budget Distribution" style="width: 100%; height: auto; border-radius: 8px;">
                </div>
                <p class="chart-description">
                    Ph√¢n b·ªë ng√¢n s√°ch ƒëa d·∫°ng t·ª´ indie films ƒë·∫øn blockbusters, ph·∫£n √°nh th·ªã tr∆∞·ªùng ƒëi·ªán ·∫£nh to√†n c·∫ßu.
                </p>
            </div>

            <!-- Vote Average Distribution -->
            <div class="chart-card">
                <h3>‚≠ê Ph√¢n b·ªë ƒëi·ªÉm ƒë√°nh gi√°</h3>
                <div class="chart-container">
                    <img src="{{ url_for('static', filename='images/charts/vote_dist.png') }}" alt="Vote Distribution" style="width: 100%; height: auto; border-radius: 8px;">
                </div>
                <p class="chart-description">
                    ƒêi·ªÉm ƒë√°nh gi√° t·∫≠p trung ch·ªß y·∫øu t·ª´ 5.5 ƒë·∫øn 7.5, cho th·∫•y ch·∫•t l∆∞·ª£ng phim t∆∞∆°ng ƒë·ªëi ƒë·ªìng ƒë·ªÅu.
                </p>
            </div>

            <!-- Runtime Distribution -->
            <div class="chart-card">
                <h3>‚è±Ô∏è Ph√¢n b·ªë th·ªùi l∆∞·ª£ng phim</h3>
                <div class="chart-container">
                    <img src="{{ url_for('static', filename='images/charts/runtime_dist.png') }}" alt="Runtime Distribution" style="width: 100%; height: auto; border-radius: 8px;">
                </div>
                <p class="chart-description">
                    H·∫ßu h·∫øt c√°c phim c√≥ th·ªùi l∆∞·ª£ng t·ª´ 90-120 ph√∫t, ph√π h·ª£p v·ªõi ƒë·ªãnh d·∫°ng phim truy·ªán.
                </p>
            </div>
            
            <!-- Model Performance -->
            <div class="chart-card">
                <h3>üéØ Hi·ªáu su·∫•t m√¥ h√¨nh XGBoost</h3>
                <div class="chart-container">
                    <img src="{{ url_for('static', filename='images/charts/confusion_matrix_xgboost.png') }}" alt="Confusion Matrix" style="width: 100%; height: auto; border-radius: 8px;">
                </div>
                <p class="chart-description">
                    Ma tr·∫≠n nh·∫ßm l·∫´n cho th·∫•y ƒë·ªô ch√≠nh x√°c cao c·ªßa model trong vi·ªác ph√¢n lo·∫°i phim th√†nh c√¥ng/th·∫•t b·∫°i.
                </p>
            </div>

            <!-- ROC Curve -->
            <div class="chart-card">
                <h3>üìà ƒê∆∞·ªùng cong ROC</h3>
                <div class="chart-container">
                    <img src="{{ url_for('static', filename='images/charts/roc_curve_xgboost.png') }}" alt="ROC Curve" style="width: 100%; height: auto; border-radius: 8px;">
                </div>
                <p class="chart-description">
                    ROC curve v·ªõi AUC cao cho th·∫•y model ph√¢n bi·ªát t·ªët gi·ªØa phim th√†nh c√¥ng v√† th·∫•t b·∫°i.
                </p>
            </div>

            <!-- Feature Importance -->
            <div class="chart-card chart-full">
                <h3>üîç ƒê·ªô quan tr·ªçng c·ªßa c√°c y·∫øu t·ªë</h3>
                <div class="chart-container">
                    <img src="{{ url_for('static', filename='images/charts/shap_summary_xgboost.png') }}" alt="SHAP Summary" style="width: 100%; height: auto; border-radius: 8px;">
                </div>
                <p class="chart-description">
                    Bi·ªÉu ƒë·ªì SHAP cho th·∫•y Vote Average v√† Vote Count l√† 2 y·∫øu t·ªë quan tr·ªçng nh·∫•t quy·∫øt ƒë·ªãnh th√†nh c√¥ng c·ªßa phim.
                </p>
            </div>
        </div>
    </div>
</section>

<section class="data-insights">
    <div class="container">
        <h2>üîç Insights ch√≠nh t·ª´ d·ªØ li·ªáu</h2>
        <div class="insights-grid">
            <div class="insight-card">
                <h4>üéØ Y·∫øu t·ªë quy·∫øt ƒë·ªãnh th√†nh c√¥ng</h4>
                <ul>
                    <li><strong>ROI ‚â• 1.0:</strong> Phim c√≥ l·ª£i nhu·∫≠n (thu h·ªìi v·ªën ƒë·∫ßu t∆∞)</li>
                    <li><strong>Vote Average ‚â• 6.5:</strong> ƒêi·ªÉm ƒë√°nh gi√° t·ªët t·ª´ kh√°n gi·∫£</li>
                    <li>Th·ªùi l∆∞·ª£ng phim t·ªëi ∆∞u: 90-120 ph√∫t</li>
                    <li>Ng√¢n s√°ch h·ª£p l√Ω, kh√¥ng qu√° cao ho·∫∑c qu√° th·∫•p</li>
                    <li>{{ stats.movies_with_profit }} phim c√≥ l√£i / {{ stats.movies_with_loss }} phim l·ªó</li>
                </ul>
            </div>
            <div class="insight-card">
                <h4>üìä Th·ªëng k√™ ch·∫•t l∆∞·ª£ng d·ªØ li·ªáu</h4>
                <ul>
                    <li><strong>Dataset g·ªëc:</strong> {{ stats.total_raw_movies }} b·ªô phim (1990-2024)</li>
                    <li><strong>Dataset ph√¢n t√≠ch:</strong> {{ stats.total_movies }} b·ªô phim ({{ "%.1f"|format(100 - stats.removal_percentage) }}%)</li>
                    <li><strong>ƒê√£ lo·∫°i b·ªè:</strong> {{ stats.removed_movies }} phim thi·∫øu d·ªØ li·ªáu quan tr·ªçng</li>
                    <li>{{ stats.genres_count }} th·ªÉ lo·∫°i phim kh√°c nhau</li>
                    <li>ROI trung b√¨nh: {{ "%.2f"|format(stats.avg_roi) }}x ({{ "%.0f"|format((stats.avg_roi - 1) * 100) }}% l·ª£i nhu·∫≠n)</li>
                    <li>Doanh thu TB: ${{ "{:,.0f}".format(stats.avg_revenue) }}</li>
                </ul>
            </div>
            <div class="insight-card">
                <h4>üí° Khuy·∫øn ngh·ªã cho nh√† s·∫£n xu·∫•t</h4>
                <ul>
                    <li><strong>Ch·∫•t l∆∞·ª£ng > S·ªë l∆∞·ª£ng:</strong> T·∫≠p trung v√†o n·ªôi dung t·ªët h∆°n ng√¢n s√°ch kh·ªßng</li>
                    <li><strong>Th·ªùi ƒëi·ªÉm ph√°t h√†nh:</strong> Ch·ªçn th√°ng/nƒÉm ph√π h·ª£p v·ªõi th·ªÉ lo·∫°i</li>
                    <li><strong>Marketing hi·ªáu qu·∫£:</strong> TƒÉng Vote Count ƒë·ªÉ t·∫°o buzz</li>
                    <li><strong>H·ªçc t·ª´ d·ªØ li·ªáu:</strong> Ph√¢n t√≠ch {{ stats.total_movies }} phim th√†nh c√¥ng/th·∫•t b·∫°i</li>
                    <li><strong>ƒê·∫£m b·∫£o ROI:</strong> {{ "%.1f"|format(stats.success_rate) }}% phim ƒë·∫°t ti√™u ch√≠ th√†nh c√¥ng</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<section class="data-actions">
    <div class="container">
        <div class="actions-grid">
            <a href="{{ url_for('home') }}#predict" class="btn">D·ª± ƒëo√°n phim m·ªõi</a>
            <a href="#data-header" class="btn-outline">Xem l·∫°i bi·ªÉu ƒë·ªì</a>
        </div>
    </div>
</section>
{% endblock %}
