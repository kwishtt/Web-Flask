{% extends "base.html" %}

{% block title %}Phân tích dữ liệu phim - Movie Data Analytics{% endblock %}

{% block content %}
<section class="data-header">
    <div class="container section-header">
        <p class="eyebrow">Data Analytics</p>
        <h1>Phân tích dữ liệu điện ảnh toàn cầu</h1>
        <p>Khám phá insights từ dataset {{ stats.total_movies }} bộ phim từ nhiều quốc gia thông qua biểu đồ trực quan</p>
        
        <!-- Data Quality Explanation -->
        <div class="data-quality-info" style="background: rgba(139, 92, 246, 0.1); border-left: 4px solid #8b5cf6; padding: 20px; margin: 30px 0; border-radius: 8px;">
            <h3 style="color: #8b5cf6; margin-top: 0; font-size: 1.2rem;">📊 Về dataset phân tích</h3>
            <p style="color: #c5c7d4; line-height: 1.8; margin: 10px 0;">
                <strong style="color: #fff;">Dataset gốc:</strong> 2,193 bộ phim từ nhiều quốc gia đã chiếu tại Việt Nam (1990-2024)<br>
                <strong style="color: #fff;">Dataset phân tích:</strong> 1,018 bộ phim (46.4% dataset gốc)<br>
                <strong style="color: #fff;">Bị loại bỏ:</strong> 1,175 bộ phim (53.6%) do thiếu dữ liệu quan trọng
            </p>
            <details style="margin-top: 15px; cursor: pointer;">
                <summary style="color: #a855f7; font-weight: 600; cursor: pointer; user-select: none;">❓ Tại sao loại bỏ hơn 50% dữ liệu? (Click để xem chi tiết)</summary>
                <div style="margin-top: 15px; padding-left: 20px; border-left: 2px solid rgba(139, 92, 246, 0.3);">
                    <p style="color: #c5c7d4; line-height: 1.8;">
                        <strong style="color: #fff;">Lý do khoa học:</strong> Để đảm bảo chất lượng phân tích và model ML, chúng tôi chỉ sử dụng phim có đầy đủ thông tin:
                    </p>
                    <ul style="color: #c5c7d4; line-height: 1.8; margin: 10px 0;">
                        <li><strong style="color: #e74c3c;">774 phim</strong> không có dữ liệu <strong>Revenue</strong> (doanh thu) → Không thể tính ROI và đánh giá thành công tài chính</li>
                        <li><strong style="color: #e74c3c;">399 phim</strong> không có dữ liệu <strong>Budget</strong> (ngân sách) → Không thể tính ROI = Revenue/Budget (chia cho 0)</li>
                        <li><strong style="color: #e74c3c;">2 phim</strong> không có <strong>Vote Average</strong> → Không thể đánh giá chất lượng nội dung</li>
                    </ul>
                    <p style="color: #27ae60; font-weight: 600; margin-top: 15px;">
                        ✅ Kết quả: 1,018 phim có đầy đủ Budget, Revenue, Runtime, Vote Average - đủ để train model ML chính xác!
                    </p>
                </div>
            </details>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-number">{{ stats.total_movies }}</span>
                <span class="stat-label">Phim phân tích</span>
                <span class="stat-sublabel" style="font-size: 0.75rem; color: #a855f7;">Từ 2,193 phim gốc</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">{{ "%.1f"|format(stats.success_rate) }}%</span>
                <span class="stat-label">Tỷ lệ thành công</span>
                <span class="stat-sublabel" style="font-size: 0.75rem; color: #27ae60;">ROI≥1 & Vote≥6.5</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">${{ "{:,.0f}".format(stats.avg_budget) }}</span>
                <span class="stat-label">Ngân sách TB</span>
                <span class="stat-sublabel" style="font-size: 0.75rem; color: #3498db;">Trung bình toàn cầu</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">{{ "%.1f"|format(stats.avg_vote) }}</span>
                <span class="stat-label">Điểm đánh giá TB</span>
                <span class="stat-sublabel" style="font-size: 0.75rem; color: #e67e22;">Thang điểm 10</span>
            </div>
        </div>
    </div>
</section>

<section class="data-visualizations">
    <div class="container">
        <div class="chart-grid">
            <!-- Budget Distribution -->
            <div class="chart-card">
                <h3>📊 Phân bố ngân sách sản xuất</h3>
                <div class="chart-container">
                    {{ budget_dist|safe }}
                </div>
                <p class="chart-description">
                    Phân bố ngân sách đa dạng từ indie films đến blockbusters, phản ánh thị trường điện ảnh toàn cầu.
                </p>
            </div>

            <!-- Vote Average Distribution -->
            <div class="chart-card">
                <h3>⭐ Phân bố điểm đánh giá</h3>
                <div class="chart-container">
                    {{ vote_dist|safe }}
                </div>
                <p class="chart-description">
                    Điểm đánh giá tập trung chủ yếu từ 5.5 đến 7.5, cho thấy chất lượng phim tương đối đồng đều trên toàn cầu.
                </p>
            </div>

            <!-- Budget vs Revenue Scatter -->
            <div class="chart-card chart-full">
                <h3>💰 Mối quan hệ Ngân sách - Doanh thu</h3>
                <div class="chart-container">
                    {{ budget_revenue|safe }}
                </div>
                <p class="chart-description">
                    Màu xanh lá: Phim thành công (ROI ≥1 & Vote ≥6.5), Màu đỏ: Phim không thành công.
                    Các điểm ở trên đường chéo cho thấy phim có lãi.
                </p>
            </div>

            <!-- Genre Distribution -->
            <div class="chart-card">
                <h3>🎭 Thể loại phim phổ biến</h3>
                <div class="chart-container">
                    {{ genre_dist|safe }}
                </div>
                <p class="chart-description">
                    Drama là thể loại phổ biến nhất trên toàn cầu, theo sau bởi Action, Comedy và Thriller.
                </p>
            </div>

            <!-- Runtime Distribution -->
            <div class="chart-card">
                <h3>⏱️ Phân bố thời lượng phim</h3>
                <div class="chart-container">
                    {{ runtime_dist|safe }}
                </div>
                <p class="chart-description">
                    Hầu hết các phim có thời lượng từ 90-120 phút, phù hợp với định dạng phim truyện.
                </p>
            </div>

            <!-- Yearly Trends -->
            <div class="chart-card chart-full">
                <h3>📈 Xu hướng sản xuất và thành công theo năm</h3>
                <div class="chart-container">
                    {{ yearly_trend|safe }}
                </div>
                <p class="chart-description">
                    Số lượng phim sản xuất và tỷ lệ thành công thay đổi theo thời gian. Dữ liệu từ {{ stats.year_range }}.
                </p>
            </div>

            <!-- Vote Analysis -->
            <div class="chart-card chart-full">
                <h3>📊 Phân tích đánh giá chi tiết</h3>
                <div class="chart-container">
                    {{ vote_analysis|safe }}
                </div>
                <p class="chart-description">
                    Mối quan hệ giữa số lượng người đánh giá và điểm trung bình. Phim thành công thường có nhiều đánh giá hơn.
                </p>
            </div>

            <!-- ROI Distribution -->
            <div class="chart-card chart-full">
                <h3>💸 Phân bố tỷ suất lợi nhuận (ROI)</h3>
                <div class="chart-container">
                    {{ roi_dist|safe }}
                </div>
                <p class="chart-description">
                    ROI âm (< 0%) = thua lỗ, ROI dương (> 0%) = lãi. Đường đứt nét đỏ là điểm hòa vốn.
                </p>
            </div>
        </div>
    </div>
</section>

<section class="data-insights">
    <div class="container">
        <h2>🔍 Insights chính từ dữ liệu</h2>
        <div class="insights-grid">
            <div class="insight-card">
                <h4>🎯 Yếu tố quyết định thành công</h4>
                <ul>
                    <li><strong>ROI ≥ 1.0:</strong> Phim có lợi nhuận (thu hồi vốn đầu tư)</li>
                    <li><strong>Vote Average ≥ 6.5:</strong> Điểm đánh giá tốt từ khán giả</li>
                    <li>Thời lượng phim tối ưu: 90-120 phút</li>
                    <li>Ngân sách hợp lý, không quá cao hoặc quá thấp</li>
                    <li>{{ stats.movies_with_profit }} phim có lãi / {{ stats.movies_with_loss }} phim lỗ</li>
                </ul>
            </div>
            <div class="insight-card">
                <h4>📊 Thống kê chất lượng dữ liệu</h4>
                <ul>
                    <li><strong>Dataset gốc:</strong> {{ stats.total_raw_movies }} bộ phim (1990-2024)</li>
                    <li><strong>Dataset phân tích:</strong> {{ stats.total_movies }} bộ phim ({{ "%.1f"|format(100 - stats.removal_percentage) }}%)</li>
                    <li><strong>Đã loại bỏ:</strong> {{ stats.removed_movies }} phim thiếu dữ liệu quan trọng</li>
                    <li>{{ stats.genres_count }} thể loại phim khác nhau</li>
                    <li>ROI trung bình: {{ "%.2f"|format(stats.avg_roi) }}x ({{ "%.0f"|format((stats.avg_roi - 1) * 100) }}% lợi nhuận)</li>
                    <li>Doanh thu TB: ${{ "{:,.0f}".format(stats.avg_revenue) }}</li>
                </ul>
            </div>
            <div class="insight-card">
                <h4>💡 Khuyến nghị cho nhà sản xuất</h4>
                <ul>
                    <li><strong>Chất lượng > Số lượng:</strong> Tập trung vào nội dung tốt hơn ngân sách khủng</li>
                    <li><strong>Thời điểm phát hành:</strong> Chọn tháng/năm phù hợp với thể loại</li>
                    <li><strong>Marketing hiệu quả:</strong> Tăng Vote Count để tạo buzz</li>
                    <li><strong>Học từ dữ liệu:</strong> Phân tích {{ stats.total_movies }} phim thành công/thất bại</li>
                    <li><strong>Đảm bảo ROI:</strong> {{ "%.1f"|format(stats.success_rate) }}% phim đạt tiêu chí thành công</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<section class="data-actions">
    <div class="container">
        <div class="actions-grid">
            <a href="{{ url_for('home') }}#predict" class="btn">Dự đoán phim mới</a>
            <a href="#data-header" class="btn-outline">Xem lại biểu đồ</a>
        </div>
    </div>
</section>
{% endblock %}